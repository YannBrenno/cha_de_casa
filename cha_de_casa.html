<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Lista de Compras</title>

<style>
  body {
    font-family: Arial, sans-serif;
    background: #f4f4f4;
    padding: 20px;
  }

  .item {
    padding: 12px;
    background: white;
    border-radius: 8px;
    margin-bottom: 10px;
    cursor: pointer;
    border: 1px solid #ddd;
  }

  .item.esgotado {
    opacity: 0.4;
    pointer-events: none;
    filter: grayscale(1);
  }

  #modal {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.6);
    display: none;
    align-items: center;
    justify-content: center;
  }

  #modal-content {
    background: white;
    padding: 20px;
    border-radius: 10px;
    width: 90%;
    max-width: 350px;
  }

  button {
    margin-top: 10px;
    padding: 10px;
    width: 100%;
    background: #333;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }
</style>
</head>

<body>

<h2>Lista de Presentes</h2>

<div id="lista"></div>

<!-- Modal -->
<div id="modal">
  <div id="modal-content">
    <h3 id="modal-item"></h3>

    <label>Seu nome:</label>
    <input id="input-nome" type="text" style="width:100%;padding:8px;margin-bottom:10px;" />

    <label>Quantidade:</label>
    <input id="input-quantidade" type="number" min="1" style="width:100%;padding:8px;margin-bottom:10px;" />

    <button onclick="comprar()">Comprar</button>
    <button onclick="fecharModal()" style="background:#777;margin-top:5px;">Cancelar</button>
  </div>
</div>

<script>
const URL_WEBAPP = "https://script.google.com/macros/s/AKfycbzrpcR8VB_-rR0YROnhjIt4t_iOZ0YAwCr-aaad--OZ3E_0CdrtScbLEszKaNeC9hNIOQ/exec";

const itens = [
  { nome: "Panela Antiaderente", max: 3, comprado: 0, compradores: [] },
  { nome: "Jogo de Toalhas", max: 2, comprado: 0, compradores: [] },
  { nome: "Conjunto de Pratos", max: 4, comprado: 0, compradores: [] }
];

let itemSelecionado = null;

function renderizarLista() {
  const lista = document.getElementById("lista");
  lista.innerHTML = "";

  itens.forEach((item, index) => {
    const restante = item.max - item.comprado;

    const div = document.createElement("div");
    div.className = "item" + (restante === 0 ? " esgotado" : "");
    div.onclick = () => abrirModal(index);

    div.innerHTML = `
      <strong>${item.nome}</strong><br>
      Restante: ${restante}<br>
      Compradores: ${item.compradores.join(", ") || "Nenhum ainda"}
    `;

    lista.appendChild(div);
  });
}

function abrirModal(index) {
  itemSelecionado = index;
  document.getElementById("modal-item").innerText = itens[index].nome;
  document.getElementById("modal").style.display = "flex";
}

function fecharModal() {
  document.getElementById("modal").style.display = "none";
}

function comprar() {
  const nome = document.getElementById("input-nome").value.trim();
  const qtd = parseInt(document.getElementById("input-quantidade").value);

  if (!nome || !qtd) {
    alert("Preencha nome e quantidade.");
    return;
  }

  const item = itens[itemSelecionado];

  if (item.comprado + qtd > item.max) {
    alert("Quantidade excede o limite disponÃ­vel!");
    return;
  }

  // Atualiza local
  item.comprado += qtd;
  item.compradores.push(`${nome} (${qtd})`);

  renderizarLista();
  fecharModal();

  // Envia para a planilha
  fetch(URL_WEBAPP, {
    method: "POST",
    body: JSON.stringify({
      nome: nome,
      item: item.nome,
      quantidade: qtd
    })
  })
  .then(r => r.json())
  .then(res => console.log("Resposta da planilha:", res))
  .catch(err => console.error("Erro:", err));
}

renderizarLista();
</script>

</body>
</html>
